/*! SpringRoll 0.4.0-rc.2 */
!function(){"use strict";!function(){var a=function(a){var b=Error.call(this,a);this.message=a,this.stack=b.stack},b=extend(a,Error);b.constructor=a,b.toString=function(){return this.message},namespace("springroll").LearningError=a}(),function(){var a=include("springroll.LearningError"),b=function(){this.events=Object.merge({},d)},c=b.prototype,d={2000:"startGame",2010:"endGame",2020:"startRound",2030:"endRound",2040:"startLevel",2050:"endLevel",2060:"startTutorial",2070:"endTutorial",2075:"skipTutorial",2080:"startMovie",2081:"skipMovie",2083:"endMovie",3010:"startInstruction",3110:"endInstruction",3020:"startIncorrectFeedback",3120:"endIncorrectFeedback",3021:"startCorrectFeedback",3121:"endCorrectFeedback",4010:"selectLevel",4020:"selectAnswer",4030:"startDrag",4035:"endDragOutside",4070:"offClick",4080:"dwellTime",4090:"clickHelp",4095:"clickReplay",4100:"submitAnswer"};b.globals=["game_time","level","round"],c.lookup=function(a){for(var b in this.events)if(a===this.events[b])return b;return null},c.add=function(b){for(var c in b){if(void 0!==this.events[c])throw new a("Cannot override the existing event code "+c);this.events[c]=b[c]}};var e=[{name:"description",type:"string",info:"The text or description of the instruction"},{name:"identifier",type:"string",info:"A unique identifier for this piece of instruction"},{name:"media_type",type:["audio","animation","other"],info:"The type of media that has just played"},{name:"total_duration",type:"int",info:"The estimated duration of the media playback in milliseconds (if it ran uninterrupted)"}];b.args={3010:e,3020:e,3021:e,2080:[{name:"movie_id",type:"string",info:"The identifier for the movie that was playing"},{name:"duration",type:"int",info:"The duration of the media playback in milliseconds"},{name:"description",type:"string",info:"The text or description of the instruction"}]},c.destroy=function(){this.events=null},namespace("springroll").EventCatalog=b}(),function(){var a=(include("springroll.EventCatalog"),function(a,b,c,d,e){this.eventCode=a,this.api=b,this.args=c||null,this.eventArgs=d||null,this.info=e||null}),b=a.prototype;b.hasProperty=function(a,b){var c=b?this.eventArgs:this.args;if(!c||!c.length)return!1;for(var d=0,e=c.length;e>d;d++)if(a===c[d].name)return!0;return!1},b.docs=function(){return""},b._format=function(a,b){var c="";if(b=b||"	",a&&a.length){c+="\n";for(var d,e=a.length,f=0;e>f;f++){d=a[f],c+=b+d.name+":";var g=d.type;c+=Array.isArray(g)?"["+g.join(", ")+"]":g,d.args&&(c+=" {",c+=this._format(d.args,b+"	"),c+="\n"+b+"}"),e-1>f&&(c+=","),c+="\n"}}return c},b.toString=function(){return this.api+" ("+this._format(this.args)+")"},namespace("springroll").EventSignature=a}(),function(){var a=include("springroll.LearningError"),b=function(b,c,d){a.call(this,b),this.eventCode=c,this.api=d,this.signature=null},c=extend(b,a);c.constructor=b,c.toString=function(){return this.message+" [eventCode: "+this.eventCode+", api: '"+this.api+"']"},namespace("springroll").EventError=b}(),function(){var a=include("springroll.EventError"),b=function(b,c,d){a.call(this,b,null,null),this.property=c,this.value=d},c=b.prototype=Object.create(a.prototype);b.prototype.constructor=b,c.toString=function(){return this.message+" [property: '"+this.property+"', value: '"+JSON.stringify(this.value)+"', eventCode: "+this.eventCode+", api: '"+this.api+"']"},namespace("springroll").ValidationError=b}(),function(){var a=include("springroll.ValidationError"),b=include("springroll.EventError"),c=include("springroll.EventCatalog"),d={};d.argsMap=function(a,d){var e,f,g=[],h={};for(e=0;e<a.length;e++)f=a[e],-1===c.globals.indexOf(f.name)&&g.push(f);if(g.length!=d.length)throw new b("Arguments length doesn't match the API, expected "+g.length+" but got "+d.length);for(e=0;e<g.length;e++)f=g[e],h[f.name]=d.shift();return h},d.validate=function(a,d){for(var f,g,h={},i=0,j=a.length;j>i;i++)if(f=a[i],-1===c.globals.indexOf(f.name)){if(f=a[i],g=d[f.name],void 0===g)throw new b("No value found for argument '"+f.name+"'");e(f.type,g,f.args||null,f.name),h[f.name]=g}return h};var e=function(b,c,d,f){if(void 0===c||null===c)throw new a("Supplied value is empty",f,c);if("*"!==b){if("string"===b&&typeof c!==b||"int"===b&&parseInt(c)!==c||"number"===b&&parseFloat(c)!==c||"array"===b&&!Array.isArray(c)||"boolean"===b&&typeof c!==b||"object"===b&&typeof c!==b)throw new a("Not a valid "+b,f,c);var g,h;if(/^array\-\>(int|boolean|string|number|array|object)$/.test(b)){if(!Array.isArray(c))throw new a("Not a valid "+b,f,c);var i=b.replace("array->","");for(g=0,h=c.length;h>g;g++)try{e(i,c[g],d,f)}catch(j){throw new a("Invalid "+b+" at index "+g,f,c)}}if(Array.isArray(b)&&-1===b.indexOf(c))throw new a("Value is not valid in set",f,c);if("object"===b&&d)for(h=d.length,g=0;h>g;g++){var k=d[g];e(k.type,c[k.name],k.args,f+"."+k.name)}}};namespace("springroll").EventUtils=d}(),function(a,b){var c=(include("springroll.Application"),include("springroll.Debug",!1),include("springroll.EventCatalog")),d=include("springroll.EventDispatcher"),e=include("springroll.EventError"),f=include("springroll.EventSignature"),g=include("springroll.EventUtils"),h=include("springroll.LearningError"),i=(include("springroll.SavedData"),include("springroll.ValidationError"),function(a,b){d.call(this),this.catalog=new c;this._timers={},this.spec=null,this._app=a,this._feedback=null,this._movie=null,this._history=[],this._level=null,this._round=null,this._feedbackStartRound=null,n=n.bind(this),a.on("update",n),this.on(m,this._onCalled.bind(this))});i.throwErrors=!1;var j=d.prototype,k=extend(i,d),l="learningEvent",m="called";k._handleError=function(a){try{throw"string"==typeof a&&(a=new h(a)),a}catch(b){if(i.throwErrors)throw b}},k.addMap=function(a){if(a)try{this.catalog.add(a)}catch(b){this._handleError(b)}},Object.defineProperty(k,"spec",{get:function(){return this._spec},set:function(a){if(this._spec=a,a){var d,e,g,h;for(h in a.events){d=this.catalog.events[h],d||(d="event"+h,this.catalog.events[h]=d),g=a.events[h],this[d]===b?(this[d]=this._specTrack.bind(this,d),e=g.args):e=c.args[h];var i=new f(h,d,e,g.args,g.info);this[d].signature=i}}}}),k.toggleDocs=function(){this._handleError("toggleDocs only available in dev build")},Object.defineProperty(k,"showTray",{set:function(a){this._handleError("showTray setter only available in dev build")}}),k.startTimer=function(a){return this._timers[a]!==b?void this._handleError("Timer exists matching '"+a+"', call stopTimer first"):void(this._timers[a]=0)},k.pollTimer=function(a){return this._timers[a]===b?void this._handleError("Timer doesn't exist matching '"+a+"'"):0|this._timers[a]},k.gameTime=function(){return this.pollTimer("_game")},k.stopTimer=function(a){var b=this.pollTimer(a);return this.removeTimer(a),b},k.removeTimer=function(a){this._timers[a]!==b&&delete this._timers[a]};var n=function(a){for(var b in this._timers)this._timers[b]+=a};k.startGame=function(){var a=this.startGame.signature;return a?(a.hasProperty("round",!0)&&(this._round=0),a.hasProperty("level",!0)&&(this._level=0),this._history.length=0,this._history.push("startGame"),this.startTimer("_game"),void this._track("startGame",{version:this._spec.version})):void this._handleError("startGame: signature is undefined")},k.endGame=function(a){var b=this.gameTime(),c=this.endGame.signature;a&&c.hasProperty("exit_type",!0)?this._track("endGame",{session_duration:b,exit_type:a}):this._track("endGame",{session_duration:b}),this._history.length=0},k._startFeedback=function(a,b,c,d,e){if(this._feedback)return void this._handleError("Feedback or instruction already started, stop it first");var f={media_type:d,description:b,identifier:c,total_duration:e};this._feedbackStartRound=this._round,this._track(a,f),this.startTimer("_feedback"),this._feedback=f},k._endFeedback=function(a){var b=this._feedback;return b?(delete b.total_duration,b.duration=this.stopTimer("_feedback"),this._feedback=null,this._track(a,b,this._feedbackStartRound),void(this._feedbackStartRound=null)):void this._handleError("Feedback or instruction not found, start it first")},k.startInstruction=function(a,b,c,d){this._startFeedback("startInstruction",a,b,c,d)},k.endInstruction=function(){this.requires&&this.requires("startInstruction")&&this._endFeedback("endInstruction")},k.startIncorrectFeedback=function(a,b,c,d){this._startFeedback("startIncorrectFeedback",a,b,c,d)},k.endIncorrectFeedback=function(){this.requires&&this.requires("startIncorrectFeedback")&&this._endFeedback("endIncorrectFeedback")},k.startCorrectFeedback=function(a,b,c,d){this._startFeedback("startCorrectFeedback",a,b,c,d)},k.endCorrectFeedback=function(){this.requires&&this.requires("startCorrectFeedback")&&this._endFeedback("endCorrectFeedback")},k.startMovie=function(a,b,c){return this._movie?void this._handleError("Movie is already started called skipMovie or endMovie first"):(this._movie={movie_id:a,duration:b,description:c},this.startTimer("_movie"),void this._track("startMovie",this._movie))},k.skipMovie=function(){if(this.requires&&this.requires("startMovie")){var a=this._movie;if(!a)return void this._handleError("No movie started, call startMovie first");a.time_played=this.stopTimer("_movie"),this._movie=null,this._track("skipMovie",a)}},k.endMovie=function(){if(this.requires&&this.requires("startMovie")){var a=this._movie;if(!a)return void this._handleError("No movie started, call startMovie first");this.removeTimer("_movie");var b=this._movie;this._movie=null,this._track("endMovie",b)}},k._onCalled=function(a){"startRound"===a&&null!==this._round?this._round++:"startLevel"===a&&null!==this._level&&this._level++},k._specTrack=function(a){var b=this[a].signature,c=null;try{c=g.argsMap(b.args,Array.prototype.slice.call(arguments,1))}catch(d){return d instanceof e&&(d.api=a,d.eventCode=this.catalog.lookup(a),d.signature=b),void this._handleError(d)}this._track(a,c)},k._track=function(a,c,d){if(this.requires&&this.requires("startGame")){var f=this.catalog.lookup(a),h=this._spec.events[f],i=this[a].signature,j=null;if(h===b)return void this._handleError(new e("Supplied event code is invalid",f,a));try{j=g.validate(i.eventArgs,c)}catch(k){return k instanceof e&&(k.api=a,k.eventCode=f,k.signature=i),void this._handleError(k)}this.trigger(m,a),null!==this._level&&(j.level=this._level),d!==b&&null!==d?j.round=d:null!==this._round&&(j.round=this._round),j.game_time=this.gameTime(),j.event_code=parseInt(f),this._history.push(a),this.trigger(a,j),this.trigger(l,{game_id:this._spec.gameId,event_id:h.id,event_data:j})}},k.requires=function(a){return-1===this._history.indexOf(a)?(this._handleError("Learning API '"+a+"' needs to be called first"),!1):!0},k.destroy=function(){this._app&&this._app.off("update",n),this.catalog&&(this.catalog.destroy(),this.catalog=null),this.off(m),this._app=null,this._timers=null,this._spec=null,this._history=null,this._movie=null,this._feedback=null,j.destroy.call(this)},namespace("springroll").Learning=i}(window.jQuery),function(a){var b=include("springroll.ApplicationPlugin"),c=include("springroll.Learning"),d=new b(10);d.setup=function(){this.learning=new c(this,!1),this.once("configLoaded",function(a){a.spec&&(this.learning.addMap(a.specDictionary||null),this.learning.spec=a.spec)}),this.learning.on("learningEvent",function(a){this.trigger("learningEvent",a)}.bind(this)),this.once("endGame",function(a){this.learning.endGame(a)}),this.once("init",function(){this.learning.startGame()})},d.teardown=function(){this.learning&&(this.learning.destroy(),this.learning=null)}}();}();