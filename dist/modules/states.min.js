/*! SpringRoll 0.3.9 */
!function(){"use strict";!function(a){var b,c,d,e=function(a,e){c||(c=include("springroll.StateManager"),d=include("springroll.DelayedCall"),b=include("springroll.Debug",!1)),e=Object.merge({next:null,previous:null,delayLoad:0},e||{}),this.stateId=null,this.manager=null,this.panel=a,this._destroyed=!1,this._active=!1,this._isLoading=!1,this._canceled=!1,this._onEnterProceed=null,this._onLoadingComplete=null,this._enabled=!1,this._nextState=e.next,this._prevState=e.previous,this.delayLoad=e.delayLoad,this.panel.visible=!1},f=e.prototype;f.exit=function(){},f.exitStart=function(){},f.cancel=function(){},f.enter=function(){},f.enterDone=function(){},f.nextState=function(){var a=typeof this._nextState;this._nextState&&("function"===a?this._nextState():"string"===a&&(this.manager.state=this._nextState))},f.previousState=function(){var a=typeof this._prevState;this._prevState&&("function"===a?this._prevState():"string"===a&&(this.manager.state=this._prevState))},f.loadingStart=function(){this._isLoading||(this._isLoading=!0,this.manager.loadingStart(),this._onLoadingComplete=this._onEnterProceed,this._onEnterProceed=null)},f.loadingDone=function(b){if(b===a&&(b=this.delayLoad),this._isLoading){if(b&&"number"==typeof b)return void new d(this.loadingDone.bind(this,0),b,{useFrames:!0});this._isLoading=!1,this.manager.loadingDone(),this._onLoadingComplete&&(this._onLoadingComplete(),this._onLoadingComplete=null)}},Object.defineProperty(f,"canceled",{get:function(){return this._canceled}}),Object.defineProperty(f,"active",{get:function(){return this._active}}),Object.defineProperty(f,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a}}),Object.defineProperty(f,"destroyed",{get:function(){return this._destroyed}}),f._internalExit=function(){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.animator.stop(this.panel)),this._enabled=!1,this.panel.visible=!1,this._active=!1,this.exit()},f._internalEntering=function(){this.enter()},f._internalExitStart=function(){this.exitStart()},f._internalEnter=function(a){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.animator.stop(this.panel)),this._enabled=!1,this._active=!0,this._canceled=!1,this._onEnterProceed=a,this._internalEntering(),this._onEnterProceed&&(this._onEnterProceed(),this._onEnterProceed=null)},f._internalCancel=function(){this._active=!1,this._canceled=!0,this._isLoading=!1,this._internalExit(),this.cancel()},f._internalEnterDone=function(){this._canceled||(this.enabled=!0,this.enterDone())},f.destroy=function(){this.panel=null,this.manager=null,this._destroyed=!0,this._onEnterProceed=null,this._onLoadingComplete=null},namespace("springroll").State=e,namespace("springroll").BaseState=e}(),function(a){var b=function(b,c,d){this.currentState=c,this.visibleState=d===a?c:d,this.type=b};b.prototype;b.VISIBLE="onVisible",b.HIDDEN="onHidden",namespace("springroll").StateEvent=b}(),function(a){var b=(include("springroll.Debug",!1),include("springroll.EventDispatcher")),c=(include("springroll.State"),include("springroll.StateEvent")),d=function(a,c){b.call(this),this._display=a,this.transition=null,this._transitionSounds=c||null,this._states={},this._state=null,this._stateId=null,this._oldState=null,this._isLoading=!1,this._isTransitioning=!1,this._destroyed=!1,this._queueStateId=null,this.hideBlocker(),this._onTransitionLoading=this._onTransitionLoading.bind(this),this._onTransitionOut=this._onTransitionOut.bind(this),this._onStateLoaded=this._onStateLoaded.bind(this),this._onTransitionIn=this._onTransitionIn.bind(this)},e=extend(d,b),f=d.TRANSITION_IN="onTransitionIn",g=d.TRANSITION_LOADING="onTransitionLoading",h=d.TRANSITION_IN_DONE="onTransitionInDone",i=d.TRANSITION_OUT="onTransitionOut",j=d.TRANSITION_OUT_DONE="onTransitionOutDone",k=d.TRANSITION_INIT_DONE="onInitDone",l=d.LOADING_START="onLoadingStart",m=d.LOADING_DONE="onLoadingDone";e.addState=function(a,b){this._states[a]=b,b.stateId=a,b.manager=this},e.changeTransition=function(a){this.transition=a},e.getCurrentState=function(){return this._state},Object.defineProperty(e,"currentState",{get:function(){return this._state}}),e.getStateById=function(a){return this._states[a]},e.isBusy=function(){return this._isLoading||this._isTransitioning},e.loadingStart=function(){this._destroyed||(this.trigger(l),this._onTransitionLoading())},e.loadingDone=function(){this._destroyed||this.trigger(m)},e.showBlocker=function(){this._display.enabled=!1},e.hideBlocker=function(){this._display.enabled=!0},e.refresh=function(){this.state=this._stateId},Object.defineProperty(e,"state",{set:function(a){return this._isTransitioning?void(this._queueStateId=a):(this._stateId=a,this.showBlocker(),this._oldState=this._state,this._state=this._states[a],void(this._oldState?this._isLoading?(this._oldState._internalCancel(),this._isLoading=!1,this._state._internalEnter(this._onStateLoaded)):(this._isTransitioning=!0,this._oldState._internalExitStart(),this.showBlocker(),this.trigger(i),this._transitioning(i,this._onTransitionOut)):(this._isTransitioning=!0,this.transition&&(this.transition.visible=!0),this._onTransitionLoading(),this.trigger(k),this._isLoading=!0,this._state._internalEnter(this._onStateLoaded))))},get:function(){return this._stateId}}),e.setState=function(a){this.state=a},e._onTransitionOut=function(){this.trigger(j),this._isTransitioning=!1,this.has(c.HIDDEN)&&this.trigger(c.HIDDEN,new c(c.HIDDEN,this._state,this._oldState)),this._oldState.panel.visible=!1,this._oldState._internalExit(),this._oldState=null,this._onTransitionLoading(),this._processQueue()||(this._isLoading=!0,this._state._internalEnter(this._onStateLoaded))},e._onStateLoaded=function(){this._isLoading=!1,this._isTransitioning=!0,this.has(c.VISIBLE)&&this.trigger(c.VISIBLE,new c(c.VISIBLE,this._state)),this._state.panel.visible=!0,this.trigger(f),this._transitioning(f,this._onTransitionIn)},e._onTransitionIn=function(){this.transition&&(this.transition.visible=!1),this.trigger(h),this._isTransitioning=!1,this.hideBlocker(),this._processQueue()||this._state._internalEnterDone()},e._processQueue=function(){if(this._queueStateId){var a=this._queueStateId;return this._queueStateId=null,this.state=a,!0}return!1},e._onTransitionLoading=function(){if(this.transition){var a,b=this._transitionSounds;b&&(a=b.loading||b.loop);var c=this._display.animator;c.instanceHasAnimation(this.transition,g)?(this.trigger(g),c.play(this.transition,{anim:g,audio:a})):c.instanceHasAnimation(this.transition,"transitionLoop")&&(this.trigger(g),c.play(this.transition,{anim:"transitionLoop",audio:a}))}},e.showTransitionOut=function(a){this.showBlocker(),this._transitioning(i,function(){this._onTransitionLoading(),a&&a()}.bind(this))},e.showTransitionIn=function(a){this._transitioning(f,function(){this.hideBlocker(),this.transition.visible=!1,a&&a()}.bind(this))},e._transitioning=function(a,b){var c=this.transition,d=this._transitionSounds;if(!c)return b();c.visible=!0;var e;d&&(e=a==f?d["in"]:d.out),this._display.animator.play(c,{anim:a,audio:e},b)},e.next=function(){this._state.nextState()},e.previous=function(){this._state.previousState()},e.destroy=function(){if(this._destroyed=!0,this.off(),this.transition&&this._display.animator.stop(this.transition),this._state&&this._state._internalExit(),this._states)for(var a in this._states)this._states[a].destroy(),delete this._states[a];this.transition=null,this._state=null,this._oldState=null,this._states=null},namespace("springroll").StateManager=d}(),function(){var a=include("springroll.ApplicationPlugin"),b=include("springroll.StateManager"),c=(include("springroll.Debug",!1),new a);c.setup=function(){this._states=null,this.manager=null,this._transition=null,Object.defineProperty(this,"transition",{set:function(a){if(!this.display)throw"No default display";var b=this.display.stage;this._transition&&b.removeChild(this._transition),this._transition=a,this.manager&&(this.manager.transition=a),a&&(a.stop&&a.stop(),b.addChild(a))},get:function(){return this._transition}}),this.options.add("state",null,!0),this.options.add("transition"),this.options.add("transitionSounds",{"in":null,out:null},!0),Object.defineProperty(this,"states",{set:function(a){if(this.manager)throw"States already set";if(!this.display)throw"No default display";var c=this.manager=new b(this.display,this.options.transitionSounds),d=this.display.stage;for(var e in a)c.addState(e,a[e]),d.addChild(a[e].panel),this.trigger("stateAdded",e,a[e]);this._states=a;var f=this._transition||this.options.transition;f&&(this.transition=f,f.gotoAndStop&&f.gotoAndStop("onTransitionOut_stop")),this.options.state&&(c.state=this.options.state)},get:function(){return this._states}})},c.teardown=function(){this._state=null,this.manager&&(this.manager.destroy(),this.manager=null),this.transition&&(this.display&&this.display.adapter.removeChildren(this.transition),this.transition=null)}}();}();