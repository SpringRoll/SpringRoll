/*! Bellhop 1.2.0 */
!function(){"use strict";!function(a){function b(a,b){return a._priority-b._priority}var c=function(){this._listeners={}},d=c.prototype;d.on=function(a,c,d){if("string"!=typeof a)for(var e in a)this.on(e,a[e],d);else for(var f,g=a.split(" "),h=0,i=g.length;i>h;h++)a=g[h],f=this._listeners[a],f||(f=this._listeners[a]=[]),c._priority=parseInt(d)||0,-1===f.indexOf(c)&&(f.push(c),f.length>1&&f.sort(b));return this},d.off=function(a,b){if(void 0===a||!this._listeners)return this._listeners={},this;if(void 0===this._listeners[a])return this;if(void 0===b)delete this._listeners[a];else for(var c=this._listeners[a],d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}return this},d.trigger=function(a){"string"==typeof a&&(a={type:a});var b=this._listeners[a.type];if(void 0!==b)for(var c=b.length-1;c>=0;c--)b[c](a)},d.destroy=function(){this._listeners=null},a.BellhopEventDispatcher=c}(window),function(a,b){var c=a.BellhopEventDispatcher,d=function(){c.call(this),this.onReceive=this.receive.bind(this),this.connected=!1,this.name="",this.isChild=!0,this.connecting=!1,this.origin="*",this._sendLater=[],this.supported=null,this.iframe=null},e=c.prototype,f=d.prototype=Object.create(e);f.receive=function(a){if(a.source===this.target){var b=a.data;if("connected"===b){this.connecting=!1,this.connected=!0,this.trigger("connected"),this.isChild||this.target.postMessage(b,this.origin);var c,e=this._sendLater.length;if(e>0){for(c=0;e>c;c++){var f=this._sendLater[c];this.send(f.type,f.data)}this._sendLater.length=0}}else{if(!this.connected)return;try{b=JSON.parse(b,d.reviver)}catch(g){return}"object"==typeof b&&b.type&&this.trigger(b)}}},f.toString=function(){return"[Bellhop '"+this.name+"']"},Object.defineProperty(f,"target",{get:function(){return this.isChild?a.parent:this.iframe.contentWindow}}),f.connect=function(c,d){if(this.connecting)return this;this.disconnect(),this.connecting=!0,this._sendLater||(this._sendLater=[]),this.iframe=c||null;var e=this.isChild=c===b,f=this.target;return this.supported=e?!!f&&a!=f:!!f,this.origin=d===b?"*":d,a.attachEvent?a.attachEvent("onmessage",this.onReceive):a.addEventListener("message",this.onReceive),e&&(a===f?this.trigger("failed"):"complete"===a.document.readyState?f.postMessage("connected",this.origin):a.onload=function(){f.postMessage("connected",this.origin)}.bind(this)),this},f.disconnect=function(){return this.connected=!1,this.connecting=!1,this.origin=null,this.iframe=null,this._sendLater&&(this._sendLater.length=0),this.isChild=!0,a.detachEvent?a.detachEvent("onmessage",this.onReceive):a.removeEventListener("message",this.onReceive),this},f.send=function(a,c){if("string"!=typeof a)throw"The event type must be a string";if(a={type:a},c!==b&&(a.data=c),this.connecting)this._sendLater.push(a);else{if(!this.connected)return this;this.target.postMessage(JSON.stringify(a),this.origin)}return this},f.fetch=function(a,c,d,e){var f=this;if(!this.connecting&&!this.connected)throw"No connection, please call connect() first";e=e===b?!1:e;var g=function(a){e&&f.off(a.type,g),c(a)};return this.on(a,g),this.send(a,d),this},f.respond=function(a,c,d){d=d===b?!1:d;var e=this,f=function(b){d&&e.off(b.type,f),e.send(a,"function"==typeof c?c():c)};return this.on(a,f),this},f.destroy=function(){e.destroy.call(this),this.disconnect(),this._sendLater=null},d.reviver=function(a,b){if(b&&"string"==typeof b.__classname){var c=g(b.__classname);if(c){var d=new c;if(d.fromJSON)return d.fromJSON(b),d}}return b};var g=function(b){for(var c=b.split("."),d=a;c.length;)if(d=d[c.shift()],!d)return;return d};a.Bellhop=d}(window);}();